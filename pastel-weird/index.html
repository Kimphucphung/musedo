<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Muse.do — pastel/weird</title>
  <!-- Tailwind via CDN (no build needed) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            roseglass: { 50:'#fff1f5',100:'#ffe4ec',200:'#fecdd6',300:'#fda4b8',400:'#fb7185',500:'#f43f5e' }
          },
          boxShadow: { glass: '0 10px 40px -10px rgba(240,46,170,.25)' }
        }
      }
    }
  </script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    .blob{filter:blur(60px);opacity:.7}
    /* Garden visuals */
    .garden-water {background: radial-gradient(120% 120% at 50% 0%, #fdf2f8 0%, #ffe4e6 35%, #fbcfe8 70%, #f5d0fe 100%);} 
    .island {position:relative;width:90%;max-width:760px;margin: auto; height:380px;border-radius:50% 50% 45% 55% / 60% 40% 60% 40%;background: radial-gradient(60% 60% at 50% 40%, #bbf7d0 0%, #86efac 45%, #22c55e 60%, #16a34a 75%, #0ea5e9 120%);box-shadow: inset 0 8px 30px rgba(0,0,0,.15), 0 15px 40px rgba(0,0,0,.25);} 
    .flower {position:absolute; transform-origin: bottom center;} 
    .flower svg {filter: drop-shadow(0 6px 10px rgba(0,0,0,.1));}
    .flower.sm {transform: translate(-50%, -100%) scale(.8)  rotate(var(--rot,0deg));}
    .flower.md {transform: translate(-50%, -100%) scale(1)    rotate(var(--rot,0deg));}
    .flower.lg {transform: translate(-50%, -100%) scale(1.35) rotate(var(--rot,0deg));}
  </style>
</head>
<body class="min-h-screen text-rose-900 relative overflow-x-hidden">
  <!-- dreamy backdrop -->
  <div class="absolute inset-0 -z-10 bg-gradient-to-b from-pink-100 via-rose-100 to-fuchsia-100"></div>
  <div class="blob absolute -top-24 -left-28 h-80 w-80 rounded-full bg-pink-200"></div>
  <div class="blob absolute top-40 -right-20 h-96 w-96 rounded-full bg-fuchsia-200"></div>
  <div class="blob absolute bottom-10 left-1/2 h-72 w-72 -translate-x-1/2 rounded-full bg-rose-200"></div>

  <!-- NAV BAR -->
  <nav class="sticky top-0 z-50 bg-white/50 backdrop-blur-xl border-b border-white/40 shadow-glass">
    <div class="mx-auto max-w-6xl flex items-center gap-4 px-4 sm:px-6 py-2">
      <!-- brand at far-left -->
      <div class="text-2xl sm:text-3xl font-black tracking-tight select-none">muse.do</div>
      <!-- tabs -->
      <div class="ml-auto flex items-center gap-2 sm:gap-4">
        <button class="navBtn px-3 py-1 rounded-full font-semibold hover:bg-white/70 data-[active=true]:bg-rose-400 data-[active=true]:text-white" data-tab="tasks">Tasks</button>
        <button class="navBtn px-3 py-1 rounded-full font-semibold hover:bg-white/70 data-[active=true]:bg-rose-400 data-[active=true]:text-white" data-tab="garden">Garden</button>
        <button class="navBtn px-3 py-1 rounded-full font-semibold hover:bg-white/70 data-[active=true]:bg-rose-400 data-[active=true]:text-white" data-tab="timer">Timer</button>
        <button class="navBtn px-3 py-1 rounded-full font-semibold hover:bg-white/70 data-[active=true]:bg-rose-400 data-[active=true]:text-white" data-tab="quotes">Quotes</button>
      </div>
    </div>
  </nav>

  <main>
    <!-- ============ TAB: TASKS ============ -->
<section id="tab-tasks">
  <header class="px-6 pt-8 pb-4">
    <div class="mx-auto flex max-w-6xl items-center justify-between">
      <!-- LEFT: brand + subtitle -->
      <h1 class="flex items-center gap-3">
        <!-- logo text -->
        <span class="select-none leading-none 
                     text-4xl md:text-5xl font-black tracking-tight">
          <span class="text-rose-900">muse.</span>
          <span class="text-roseglass-500">do</span>
        </span>
        <!-- subtitle pill -->
        <span
           class="inline-flex items-center rounded-full bg-rose-200/60
           px-3 py-1 text-xs font-semibold text-rose-800 border border-white/50">Tin Work Measurement
        </span>
      </h1>
      <!-- RIGHT: Today button -->
      <button id="todayBtn"
        class="rounded-full px-3 py-2 backdrop-blur-xl bg-white/50
               border border-white/40 shadow-glass hover:bg-white/60 transition">
        Today
      </button>
    </div>
  </header>


      <section class="mx-auto grid max-w-6xl grid-cols-1 gap-6 px-6 pb-16 md:grid-cols-[300px_1fr] lg:grid-cols-[300px_minmax(400px,1fr)_360px]">
        <!-- Callendar -->
        <aside class="rounded-3xl p-4 md:p-5 backdrop-blur-xl bg-white/50 border border-white/40 shadow-glass">
          <div class="mb-3 flex items-center justify-between">
            <button id="prevMonth" class="rounded-full p-2 hover:bg-white/70">
              <div class="flex items-center justify-center"><img src="/Asset/left-arrow.png" alt="" class="h-4 object-contain rounded-xl "></div>
            </button>
            <div id="monthLabel" class="font-semibold flex items-center gap-2">📅</div>
            <button id="nextMonth" class="rounded-full p-2 hover:bg-white/70">
              <div class="flex items-center justify-center"><img src="/Asset/right-arrow.png" alt="" class="h-4 object-contain rounded-xl "></div>
            </button>
          </div>
          <div class="grid grid-cols-7 text-center text-xs font-medium text-rose-600/80">
            <div>SUN</div><div>MON</div><div>TUE</div><div>WED</div><div>THU</div><div>FRI</div><div>SAT</div>
          </div>
          <div id="calendarGrid" class="grid grid-cols-7 gap-2"></div>
          <div class="mt-4 rounded-2xl p-3 bg-white/60">
            <div class="flex items-center justify-between text-sm"><span>Month completion</span><span id="monthCompletion" class="font-semibold">0%</span></div>
            <div class="mt-2 h-2 w-full overflow-hidden rounded-full bg-rose-100"><div id="monthBar" class="h-2 rounded-full bg-roseglass-400" style="width:0%"></div></div>
            <div class="mt-2 grid grid-cols-3 text-center text-xs"><div><div id="doneCount" class="font-semibold">0</div><div>done</div></div><div><div id="totalCount" class="font-semibold">0</div><div>tasks</div></div><div><div id="streakCount" class="font-semibold">0🔥</div><div>streak</div></div></div>
          </div>
        </aside>

        <!-- Note Track Center -->
        <section class="relative overflow-hidden rounded-3xl p-4 md:p-6 backdrop-blur-xl bg-white/50 border border-white/40 shadow-glass">
          <div class="absolute -right-20 -top-20 h-40 w-40 rounded-full bg-rose-200/70 blur-3xl"></div>
          <div class="mb-4 flex items-center justify-between">
            <div>
              <div class="text-xs uppercase tracking-wide text-rose-700/70">DAY</div>
              <h2 id="dayLabel" class="text-2xl font-extrabold tracking-tight"></h2>
            </div>
            <div class="text-right">
              <div class="text-xs text-rose-700/70">Completion</div>
              <div id="dayCompletion" class="text-xl font-black">0%</div>
              <div class="text-[10px] inline-flex items-center gap-1 rounded-full bg-rose-100 px-2 py-1 mt-1">✨ vibe: <span id="vibe" class="font-semibold">Seed</span></div>
            </div>
          </div>

          <div class="mb-4 grid grid-cols-1 gap-2 md:grid-cols-[1fr_auto]">
            <div class="flex items-center gap-2 rounded-2xl bg-white/70 px-3 py-2 ring-1 ring-white/60 focus-within:ring-roseglass-400">
              <input id="newTitle" placeholder="Add a task that Future‑You will thank Past‑You for ✨" class="w-full bg-transparent outline-none placeholder:text-rose-400"/>
              <select id="newPrio" class="rounded-full bg-rose-100 px-2 py-1 text-xs"><option value="1">chill</option><option value="2" selected>normal</option><option value="3">spicy</option></select>
            </div>
            <button id="addBtn" class="inline-flex items-center justify-center gap-2 rounded-2xl bg-roseglass-400 px-4 py-2 font-semibold text-white shadow-lg hover:brightness-105 active:translate-y-px">＋ Add</button>
            <textarea id="newNote" placeholder="optional notes…" class="md:col-span-2 h-20 rounded-2xl bg-white/60 p-3 text-sm outline-none ring-1 ring-white/50 focus:ring-roseglass-400"></textarea>
          </div>

          <ul id="taskList" class="space-y-2"></ul>
          <div id="emptyMsg" class="hidden rounded-2xl bg-white/60 p-6 text-center text-sm">No tasks for this day yet. Drop one above and let it bloom 🌸</div>
        </section>

        <!-- Statistic -->
        <aside class="hidden lg:block rounded-3xl p-4 backdrop-blur-xl bg-white/50 border border-white/40 shadow-glass">
          <div class="mb-3 flex items-center justify-between"><h3 class="text-lg font-bold">Stats & Patterns</h3><div id="statsMonth" class="text-xs text-rose-700/70"></div></div>
          <div class="h-40 w-full rounded-2xl bg-white/70 p-2"><canvas id="barChart" height="140"></canvas></div>
          <div class="mt-3 grid grid-cols-2 gap-3">
            <div class="rounded-2xl bg-white/70 p-2"><canvas id="pieChart" height="160"></canvas><div class="text-center text-xs"><span id="miniDone">0</span>/<span id="miniTotal">0</span> done</div></div>
            <div class="rounded-2xl bg-white/70 p-4"><div class="text-xs text-rose-700/70">Streak</div><div id="streakText" class="text-3xl font-black">0 days</div><div class="mt-2 text-xs">Keep one tiny win per day. Your future self is applauding 🎀</div></div>
          </div>
          <div class="mt-3 rounded-2xl bg-white/70 p-4"><div class="flex items-center gap-2 text-sm font-semibold">✨ Mini milestones</div>
            <ul class="mt-2 list-disc pl-5 text-sm"><li id="mm60">Reach 60% today</li><li id="mm100">Perfect day (100%)</li><li id="mm50m">50%+ this month</li></ul>
          </div>
        </aside>
      </section>
    </section>

    <!-- ============ TAB: GARDEN ============ -->
    <section id="tab-garden" class="hidden px-6 py-8">
      <div class="mx-auto max-w-5xl rounded-3xl p-6 backdrop-blur-xl bg-white/50 border border-white/40 shadow-glass">
        <div class="flex items-center justify-between"><h2 class="text-2xl font-bold">Achievement Garden 🌱</h2><div class="text-xs text-rose-700/70" id="gardenMonth"></div></div>
        <div class="garden-water mt-4 rounded-3xl p-4"><div class="island mx-auto relative" id="gardenCanvas"></div></div>
        <div class="mt-4 grid grid-cols-1 sm:grid-cols-3 gap-3 text-sm">
          <div class="rounded-2xl bg-white/70 p-3"><div class="font-semibold">Rules</div><div>Complete <b>every day tasks</b> will plant <b>a flower</b>.</div><div>2–4 task → <b>small</b>flower, 5–6 → <b>medium</b>, ≥7 → <b>big</b>.</div></div>
          <div class="rounded-2xl bg-white/70 p-3"><div class="font-semibold">Today</div><div id="gardenToday"></div></div>
          <div class="rounded-2xl bg-white/70 p-3"><div class="font-semibold">Tip</div><div>Come back and complete daily tasks to see the flowers bloom 🌸</div></div>
        </div>
      </div>
    </section>

    <!-- ============ TAB: TIMER ============ -->
    <section id="tab-timer" class="hidden px-6 py-8">
      <div class="mx-auto max-w-xl rounded-3xl p-6 text-center backdrop-blur-xl bg-white/50 border border-white/40 shadow-glass">
        <h2 class="text-2xl font-bold mb-2">Focus Timer ⏳</h2>
        <div class="text-sm text-rose-700/70 mb-4">Select working time, press Start. When time is up, it will ring + remind you to take a break.</div>
        <div class="flex items-center justify-center gap-2 mb-4">
          <input id="tMin" type="number" min="0" value="25" class="w-20 rounded-xl bg-white/80 p-2 text-center ring-1 ring-white/60" />
          <span>:</span>
          <input id="tSec" type="number" min="0" max="59" value="00" class="w-20 rounded-xl bg-white/80 p-2 text-center ring-1 ring-white/60" />
        </div>
        <div class="flex flex-wrap items-center justify-center gap-2 mb-4">
          <button class="px-3 py-1 rounded-full bg-rose-100" data-preset="25">Pomodoro 25</button>
          <button class="px-3 py-1 rounded-full bg-rose-100" data-preset="5">Break 5</button>
          <button class="px-3 py-1 rounded-full bg-rose-100" data-preset="15">Break 15</button>
        </div>
        <div class="text-5xl font-black tracking-wider mb-4" id="tDisplay">25:00</div>
        <div class="flex items-center justify-center gap-3">
          <button id="tStart" class="px-4 py-2 rounded-full bg-rose-400 text-white shadow">Start</button>
          <button id="tPause" class="px-4 py-2 rounded-full bg-white/90 shadow ring-1 ring-white/60">Pause</button>
          <button id="tReset" class="px-4 py-2 rounded-full bg-white/90 shadow ring-1 ring-white/60">Reset</button>
        </div>
        <div id="restBanner" class="hidden mt-6 rounded-2xl bg-white/80 p-4 ring-1 ring-white/60">
          <div class="text-xl font-bold mb-2">Don't Overwork Yourself 💗</div>
          <div class="mb-3">Give Yourself <b>15 Minutes</b> Rest, Honey.</div>
          <div class="flex items-center justify-center">
            <img src="/Asset/cat-meme.png" alt="cat-meme" class="h-32 object-contain rounded-xl shadow" />
          </div>
        </div>
      </div>
    </section>

    <!-- ============ TAB: QUOTES ============ -->
    <section id="tab-quotes" class="hidden px-6 py-8">
      <div class="mx-auto max-w-xl rounded-3xl p-6 text-center backdrop-blur-xl bg-white/50 border border-white/40 shadow-glass">
        <h2 class="text-2xl font-bold mb-4">Weird Inspiration ✨</h2>
        <blockquote id="quoteBox" class="italic">Click button to get a quote!</blockquote>
        <button id="newQuoteBtn" class="mt-4 px-4 py-2 rounded-full bg-rose-400 text-white">New Quote</button>
      </div>
    </section>
  </main>

  <footer class="mx-auto max-w-6xl px-6 pb-10 text-center text-xs text-rose-700/70">Pro‑tip: tiny tasks, tiny wins. Weirdly satisfying.</footer>

<script>
// ===== Utilities =====
const $ = (s)=>document.querySelector(s); const $$=(s)=>Array.from(document.querySelectorAll(s));
const tabs=['tasks','garden','timer','quotes'];
function showTab(name){
  tabs.forEach(t=>{const el=$('#tab-'+t); if(!el) return; (t===name)?el.classList.remove('hidden'):el.classList.add('hidden');});
  $$('.navBtn').forEach(b=> b.dataset.active = (b.dataset.tab===name));
  if(name==='tasks') render();
  if(name==='garden') updateGarden();
  if(name==='timer') syncInputsFromRemaining();
}
$$('.navBtn').forEach(btn=> btn.addEventListener('click',()=> showTab(btn.dataset.tab)));

// ===== Core state for Tasks =====
const STORAGE_KEY='weird-productivity-nobuild-v3';
const todayISO=()=> new Date().toISOString().slice(0,10);
function startOfMonth(d){d=new Date(d);return new Date(d.getFullYear(),d.getMonth(),1)}
function endOfMonth(d){d=new Date(d);return new Date(d.getFullYear(),d.getMonth()+1,0)}
function addDays(date,days){const d=new Date(date);d.setDate(d.getDate()+days);return d}
function fmtMonth(d){return new Intl.DateTimeFormat(undefined,{month:'long',year:'numeric'}).format(new Date(d))}
function fmtDayLong(d){return new Intl.DateTimeFormat(undefined,{weekday:'long',month:'long',day:'numeric'}).format(new Date(d))}
function id(){return Math.random().toString(36).slice(2,9)}
function prioLabel(p){return p==3?'spicy':p==2?'normal':'chill'}
let state=loadState(); let selectedDate=todayISO(); let bar,pie;
function loadState(){try{const raw=localStorage.getItem(STORAGE_KEY);if(!raw)return{tasks:demoTasks()};const s=JSON.parse(raw);if(!Array.isArray(s.tasks))return{tasks:demoTasks()};return s}catch(e){return{tasks:demoTasks()}}}
function saveState(){localStorage.setItem(STORAGE_KEY,JSON.stringify(state))}
function demoTasks(){const t=new Date();t.setHours(0,0,0,0);const iso=(d)=>{d.setHours(0,0,0,0);return d.toISOString().slice(0,10)};const y1=new Date(t);y1.setDate(t.getDate()-1);const y2=new Date(t);y2.setDate(t.getDate()-2);return[
{id:id(),title:'Morning stretch & water',date:iso(y2),done:true,priority:1},
{id:id(),title:'Write 3 lines of journal',date:iso(y2),done:true,priority:2},
{id:id(),title:'Read 10 pages',date:iso(y1),done:true,priority:2},
{id:id(),title:'Email follow-ups (Greental)',date:iso(y1),done:false,priority:3},
{id:id(),title:'HEXACO intro draft',date:iso(t),done:false,priority:3},
{id:id(),title:'Placement logbook review',date:iso(t),done:false,priority:2},
{id:id(),title:'Walk 15 minutes',date:iso(t),done:false,priority:1},]}
function tasksFor(date){return state.tasks.filter(t=>t.date===date)}
function groupByDate(tasks){const m=new Map();tasks.forEach(t=>{if(!m.has(t.date))m.set(t.date,[]);m.get(t.date).push(t)});return m}
function computeMonthStats(monthDate){const start=startOfMonth(monthDate),end=endOfMonth(monthDate);const arr=state.tasks.filter(t=>new Date(t.date)>=start&&new Date(t.date)<=end);const map=groupByDate(arr);let total=0,done=0;const daily=[];for(let d=new Date(start);d<=end;d=addDays(d,1)){const iso=d.toISOString().slice(0,10);const list=map.get(iso)||[];const dt=list.length;const dd=list.filter(x=>x.done).length;total+=dt;done+=dd;daily.push({iso,total:dt,done:dd})}const completion=total?Math.round(done/total*100):0;return{total,done,completion,daily}}
function computeStreak(){const map=groupByDate(state.tasks);let streak=0;let d=new Date();d.setHours(0,0,0,0);while(true){const iso=d.toISOString().slice(0,10);const list=map.get(iso)||[];if(list.some(t=>t.done)){streak++;d=addDays(d,-1)}else break}return streak}
function render(){
  $('#monthLabel').textContent=fmtMonth(selectedDate); $('#statsMonth').textContent=fmtMonth(selectedDate); $('#dayLabel').textContent=fmtDayLong(selectedDate);
  const start=startOfMonth(selectedDate), end=endOfMonth(selectedDate); const first=start.getDay(); const wrap=$('#calendarGrid'); wrap.innerHTML=''; for(let i=0;i<first;i++){const s=document.createElement('div'); s.className='opacity-50'; wrap.appendChild(s)}
  const stats=computeMonthStats(selectedDate); stats.daily.forEach((d)=>{const btn=document.createElement('button');btn.className='relative aspect-square rounded-2xl p-2 text-left transition hover:bg-white/60 '+(d.iso===selectedDate?'bg-white/80 ring-2 ring-roseglass-300':'');btn.innerHTML=`<div class="flex h-full flex-col justify-between"><div class="flex items-center justify-between"><span class="text-sm font-semibold">${new Date(d.iso).getDate().toString().padStart(2,'0')}</span>${d.total>0?`<span class=\"block h-6 w-6 rounded-full border-2 border-pink-200 relative\"><span class=\"absolute inset-0 rounded-full\" style=\"box-shadow: inset 0 0 0 9999px rgba(251,113,133,${(d.done/d.total).toFixed(2)})\"></span></span>`:''}</div><div class="text-[10px] text-rose-700/70">${d.total>0?Math.round(d.done/d.total*100)+'%':''}</div></div>`;btn.addEventListener('click',()=>{selectedDate=d.iso;render()});wrap.appendChild(btn)});
  $('#monthCompletion').textContent=stats.completion+'%'; $('#monthBar').style.width=stats.completion+'%'; $('#doneCount').textContent=stats.done; $('#totalCount').textContent=stats.total; const streak=computeStreak(); $('#streakCount').textContent=streak+'🔥'; $('#streakText').textContent=streak+' days'; $('#miniDone').textContent=stats.done; $('#miniTotal').textContent=stats.total;
  const list=tasksFor(selectedDate); const ul=$('#taskList'); ul.innerHTML=''; if(list.length===0)$('#emptyMsg').classList.remove('hidden'); else $('#emptyMsg').classList.add('hidden'); list.forEach(t=>{const li=document.createElement('li'); li.className='group rounded-2xl bg-white/70 p-3 ring-1 ring-white/60 hover:ring-roseglass-300'; li.innerHTML=`<div class=\"flex items-start gap-3\"><button class=\"mt-1 inline-flex h-6 w-6 items-center justify-center rounded-full border ${t.done?'bg-roseglass-400 text-white border-roseglass-400':'border-roseglass-300 bg-white'}\">${t.done?'✓':''}</button><div class=\"flex-1\"><div contenteditable=\"true\" class=\"taskTitle text-sm md:text-base ${t.done?'line-through opacity-60':''}\">${t.title}</div>${t.notes?`<div class=\"mt-1 text-xs text-rose-700/80\">${t.notes}</div>`:''}<div class=\"mt-2 inline-flex items-center gap-2 text-[10px]\"><span class=\"rounded-full px-2 py-0.5 ${t.priority==3?'bg-rose-200 text-rose-900':t.priority==2?'bg-pink-100 text-pink-900':'bg-fuchsia-100 text-fuchsia-900'}\">priority: ${prioLabel(t.priority)}</span>${t.done?'<span class=\"rounded-full bg-emerald-100 px-2 py-0.5 text-emerald-700\">completed</span>':''}</div></div><button class=\"opacity-0 transition group-hover:opacity-100 text-roseglass-500\">🗑</button></div>`; const [toggleBtn,titleDiv,delBtn]=[li.querySelector('button'),li.querySelector('.taskTitle'),li.querySelectorAll('button')[1]]; toggleBtn.addEventListener('click',()=>{t.done=!t.done;saveState();render()}); titleDiv.addEventListener('keydown',(e)=>{if(e.key==='Enter'){e.preventDefault();titleDiv.blur()}}); titleDiv.addEventListener('blur',()=>{t.title=titleDiv.textContent.trim()||t.title;saveState();render()}); delBtn.addEventListener('click',()=>{state.tasks=state.tasks.filter(x=>x.id!==t.id);saveState();render()}); ul.appendChild(li)});
  const done=list.filter(x=>x.done).length; const total=list.length; const pct=total?Math.round(done/total*100):0; $('#dayCompletion').textContent=pct+'%'; $('#vibe').textContent=pct===100?'Blossoming':(pct>=60?'Rosy':(pct>0?'Petal':'Seed'));
  const labels=stats.daily.map(d=>new Date(d.iso).getDate()); const totalArr=stats.daily.map(d=>d.total); const doneArr=stats.daily.map(d=>d.done); const barCtx=$('#barChart').getContext('2d'); if(bar) bar.destroy(); bar=new Chart(barCtx,{type:'bar',data:{labels,datasets:[{label:'Total',data:totalArr},{label:'Completed',data:doneArr}]},options:{responsive:true,plugins:{legend:{display:true}},scales:{y:{beginAtZero:true}}}}); const pieCtx=$('#pieChart').getContext('2d'); if(pie) pie.destroy(); pie=new Chart(pieCtx,{type:'pie',data:{labels:['Done','Remaining'],datasets:[{data:[stats.done,Math.max(stats.total-stats.done,0)]}]}});
  $('#mm60').className=(pct>=60?'line-through opacity-60':''); $('#mm100').className=(pct===100?'line-through opacity-60':''); $('#mm50m').className=(stats.completion>=50?'line-through opacity-60':'');
  if (!$('#tab-garden').classList.contains('hidden')) updateGarden();
}
$('#prevMonth').addEventListener('click',()=>{const d=new Date(selectedDate); d.setMonth(d.getMonth()-1); selectedDate=new Date(d.getFullYear(),d.getMonth(),Math.min(new Date(selectedDate).getDate(),endOfMonth(d).getDate())).toISOString().slice(0,10); render()});
$('#nextMonth').addEventListener('click',()=>{const d=new Date(selectedDate); d.setMonth(d.getMonth()+1); selectedDate=new Date(d.getFullYear(),d.getMonth(),Math.min(new Date(selectedDate).getDate(),endOfMonth(d).getDate())).toISOString().slice(0,10); render()});
$('#todayBtn').addEventListener('click',()=>{selectedDate=todayISO(); render()});
$('#addBtn').addEventListener('click', addTask);
$('#newTitle').addEventListener('keydown',(e)=>{if(e.key==='Enter'){e.preventDefault();addTask()}});
function addTask(){const titleInput=$('#newTitle').value.trim(); const noteInput=$('#newNote').value.trim(); const prio=parseInt($('#newPrio').value||'2'); const title=titleInput||(noteInput?noteInput.slice(0,60):''); if(!title) return; state.tasks.unshift({id:id(),title,date:selectedDate,done:false,priority:prio,notes:noteInput||undefined}); $('#newTitle').value=''; $('#newNote').value=''; $('#newPrio').value='2'; saveState(); render()}

// ===== Garden =====
function seedRng(seedStr){let h=2166136261>>>0; for(let i=0;i<seedStr.length;i++){h^=seedStr.charCodeAt(i); h=Math.imul(h,16777619);} return ()=>{h+=0x6D2B79F5; let t=Math.imul(h^(h>>>15),1|h); t^=t+Math.imul(t^(t>>>7),61|t); return((t^(t>>>14))>>>0)/4294967296};}
function flowerTier(doneCount){ if(doneCount>=7) return 'lg'; if(doneCount>=5) return 'md'; if(doneCount>=2) return 'sm'; return 'sm'; }
function flowerSVG(kind,c1,c2){ if(kind==='tulip')return`<svg width="80" height="120" viewBox="0 0 80 120" xmlns="http://www.w3.org/2000/svg"><rect x="38" y="55" width="4" height="55" rx="2" fill="#16a34a"/><path d="M10 80 C25 70, 30 70, 40 78" stroke="#16a34a" stroke-width="4" fill="none"/><path d="M70 80 C55 70, 50 70, 40 78" stroke="#16a34a" stroke-width="4" fill="none"/><path d="M40 55 C60 55, 66 40, 62 25 C54 35, 47 25, 40 18 C33 25, 26 35, 18 25 C14 40, 20 55, 40 55Z" fill="${c1}" stroke="${c2}" stroke-width="2"/></svg>`; if(kind==='peony')return`<svg width="96" height="126" viewBox="0 0 96 126" xmlns="http://www.w3.org/2000/svg"><rect x="46" y="60" width="4" height="60" rx="2" fill="#15803d"/><circle cx="48" cy="50" r="24" fill="${c1}"/><circle cx="40" cy="48" r="20" fill="${c1}"/><circle cx="56" cy="48" r="20" fill="${c1}"/><circle cx="48" cy="50" r="10" fill="${c2}"/></svg>`; return`<svg width="72" height="120" viewBox="0 0 72 120" xmlns="http://www.w3.org/2000/svg"><rect x="34" y="58" width="4" height="58" rx="2" fill="#16a34a"/><g transform="translate(36 46)"><circle r="8" fill="${c2}"/>${Array.from({length:12}).map((_,i)=>{const a=(i*30)*Math.PI/180; const x=Math.cos(a)*16, y=Math.sin(a)*16; return `<ellipse cx="${x}" cy="${y}" rx="7" ry="14" fill="${c1}" />`}).join('')}</g></svg>`; }
function createFlowerEl(kind,tier,leftPct,topPct,rotDeg){const wrap=document.createElement('div'); wrap.className=`flower ${tier}`; wrap.style.left=leftPct+'%'; wrap.style.top=topPct+'%'; wrap.style.setProperty('--rot',rotDeg+'deg'); const colors={daisy:['#fde68a','#f59e0b'], tulip:['#fb7185','#f43f5e'], peony:['#fda4af','#fecdd3']}; wrap.innerHTML=flowerSVG(kind,colors[kind][0],colors[kind][1]); return wrap;}
function updateGarden(){const canvas=$('#gardenCanvas'); if(!canvas) return; canvas.innerHTML=''; $('#gardenMonth').textContent=fmtMonth(selectedDate); const stats=computeMonthStats(selectedDate); const todayList=tasksFor(selectedDate); const td=todayList.filter(t=>t.done).length, tt=todayList.length; $('#gardenToday').textContent= tt? `${td}/${tt} completed (${Math.round(td/tt*100)}%)` : 'No tasks today'; stats.daily.forEach(d=>{ if(d.total>0 && d.done===d.total){ const rng=seedRng(d.iso); const tier=flowerTier(d.done); const kinds=['daisy','tulip','peony']; const kind=kinds[Math.floor(rng()*kinds.length)]; const left=20+rng()*60; const top=30+rng()*55; const rot=Math.floor(rng()*20-10); canvas.appendChild(createFlowerEl(kind,tier,left,top,rot)); } }); }

// ===== Timer =====
let tRemaining=25*60; let tId=null;
function formatTime(s){const m=Math.floor(s/60).toString().padStart(2,'0'); const sec=Math.floor(s%60).toString().padStart(2,'0'); return `${m}:${sec}`}
function syncInputsFromRemaining(){const m=Math.floor(tRemaining/60); const s=tRemaining%60; $('#tMin') && ($('#tMin').value=m); $('#tSec') && ($('#tSec').value=s.toString().padStart(2,'0')); $('#tDisplay') && ($('#tDisplay').textContent=formatTime(tRemaining));}
function readInputsToRemaining(){const m=parseInt($('#tMin').value||'0',10); const s=parseInt($('#tSec').value||'0',10); tRemaining=Math.max(0,m*60+Math.min(59,s)); $('#restBanner')?.classList.add('hidden'); $('#tDisplay').textContent=formatTime(tRemaining);}
function playBeep(){const ctx=new (window.AudioContext||window.webkitAudioContext)(); const o=ctx.createOscillator(); const g=ctx.createGain(); o.type='sine'; o.frequency.value=880; o.connect(g); g.connect(ctx.destination); g.gain.setValueAtTime(0.001,ctx.currentTime); g.gain.exponentialRampToValueAtTime(0.2,ctx.currentTime+0.02); o.start(); setTimeout(()=>{g.gain.exponentialRampToValueAtTime(0.0001,ctx.currentTime+0.25); o.stop(ctx.currentTime+0.3);},250);} 
function onTimerEnd(){ playBeep(); $('#restBanner')?.classList.remove('hidden'); }
function startTimer(){ if(tId) return; readInputsToRemaining(); if(tRemaining<=0) return; tId=setInterval(()=>{ tRemaining--; $('#tDisplay').textContent=formatTime(tRemaining); if(tRemaining<=0){ clearInterval(tId); tId=null; onTimerEnd(); } },1000);} 
function pauseTimer(){ if(tId){clearInterval(tId); tId=null;} }
function resetTimer(){ pauseTimer(); readInputsToRemaining(); $('#restBanner')?.classList.add('hidden'); }
$('#tMin')?.addEventListener('change',readInputsToRemaining); $('#tSec')?.addEventListener('change',readInputsToRemaining); $('#tStart')?.addEventListener('click',startTimer); $('#tPause')?.addEventListener('click',pauseTimer); $('#tReset')?.addEventListener('click',resetTimer); $$('#tab-timer [data-preset]').forEach(b=> b.addEventListener('click',()=>{ pauseTimer(); const minutes=parseInt(b.dataset.preset,10)||0; tRemaining=minutes*60; syncInputsFromRemaining(); $('#restBanner')?.classList.add('hidden'); })); syncInputsFromRemaining();

// ===== Quotes =====
const QUOTES=['Weird is wonderful 🌸','Tiny tasks, tiny wins.','Bloom where you are planted 🌱','Your future self is applauding 👏','Its better to cry in a Lamborghini than cry in a Honda Civic', 'Whoever said money cant solve your problems? Must not have had enough money to solve them','Work smarter not harder, babe','Rich people not gonna marry dumb sh*t'];
$('#newQuoteBtn')?.addEventListener('click',()=>{$('#quoteBox').textContent=QUOTES[Math.floor(Math.random()*QUOTES.length)]});

// ===== Init =====
showTab('tasks');
</script>
</body>
</html>
